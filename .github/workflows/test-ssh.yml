name: Test SSH Connection

on:
  workflow_dispatch:

jobs:
  test-ssh:
    runs-on: ubuntu-latest
    steps:
      - name: Test SSH Connection
        uses: appleboy/ssh-action@v1.2.0
        with:
          host: ${{ secrets.SSH_HOST }}
          username: ${{ secrets.SSH_USER }}
          key: ${{ secrets.SSH_KEY }}
          port: ${{ secrets.SSH_PORT }}
          script: |
            echo "✅ SSH Connection from GitHub Actions OK"
            whoami
            pwd
            echo "---"
            echo "Checking VPS environment:"
            cd /srv/mygest/app
            echo "Current directory: $(pwd)"
            echo "Git branch: $(git branch --show-current)"
            echo "Latest commit: $(git log -1 --oneline)"
            echo "---"
            echo "Python environment:"
            source /srv/mygest/venv/bin/activate
            python --version
            echo "---"
            echo "✅ All checks passed!"
