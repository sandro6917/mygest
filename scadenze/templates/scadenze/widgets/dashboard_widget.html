{% load i18n %}

<section class="card">
  <h2>ğŸ“… {% trans "Scadenze" %}</h2>
  
  <!-- Statistiche -->
  <div class="body" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; font-size: 13px;">
      <div>
        <div style="opacity: 0.9;">Oggi</div>
        <div style="font-size: 24px; font-weight: 700;">{{ oggi_count }}</div>
      </div>
      <div>
        <div style="opacity: 0.9;">7 giorni</div>
        <div style="font-size: 24px; font-weight: 700;">{{ settimana_count }}</div>
      </div>
      <div>
        <div style="opacity: 0.9;">ğŸ”´ Critiche</div>
        <div style="font-size: 20px; font-weight: 700;">{{ critiche_count }}</div>
      </div>
      <div>
        <div style="opacity: 0.9;">â° Alert</div>
        <div style="font-size: 20px; font-weight: 700;">{{ alert_pendenti_count }}</div>
      </div>
    </div>
  </div>

  <!-- Lista prossime scadenze -->
  <div class="body">
    {% if occorrenze %}
      <ul class="list" style="margin: 0; padding: 0; list-style: none;">
        {% for occ in occorrenze %}
          {% with pratica=occ.scadenza.pratiche.all|first %}
            <li style="padding: 10px 0; border-bottom: 1px solid #f3f4f6;">
              <div style="display: flex; justify-content: space-between; align-items: start; gap: 8px;">
                <div style="flex: 1; min-width: 0;">
                  <div style="font-size: 11px; color: #6b7280; margin-bottom: 3px;">
                    {{ occ.inizio|date:"d/m/Y H:i" }}
                    {% if occ.giornaliera %}ğŸ—“ï¸{% endif %}
                  </div>
                  <a href="{% url 'scadenze:detail' occ.scadenza_id %}" style="font-weight: 600; font-size: 13px; color: #374151; text-decoration: none;">
                    {{ occ.scadenza.titolo|truncatechars:40 }}
                  </a>
                  {% if pratica %}
                    <div style="font-size: 11px; color: #9ca3af; margin-top: 2px;">
                      ğŸ—‚ï¸ {{ pratica.codice|default:pratica }}
                    </div>
                  {% endif %}
                </div>
                <div>
                  {% if occ.scadenza.priorita == 'critical' %}
                    <span style="background: #dc2626; color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: 600;">ğŸ”´</span>
                  {% elif occ.scadenza.priorita == 'high' %}
                    <span style="background: #f59e0b; color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: 600;">ğŸŸ </span>
                  {% endif %}
                </div>
              </div>
              {% with num_alerts=occ.alerts.all|length %}
                {% if num_alerts > 0 %}
                  <div style="font-size: 10px; color: #6b7280; margin-top: 4px;">
                    â° {{ num_alerts }} alert
                  </div>
                {% endif %}
              {% endwith %}
            </li>
          {% endwith %}
        {% endfor %}
      </ul>
    {% else %}
      <p style="color: #9ca3af; text-align: center; margin: 20px 0;">
        Nessuna scadenza imminente
      </p>
    {% endif %}
  </div>

  <!-- Azioni -->
  <div class="actions" style="display: flex; gap: 8px; flex-wrap: wrap;">
    <a href="{{ scadenziario_url }}" class="btn btn-sm btn-secondary" style="flex: 1; text-align: center; font-size: 12px; padding: 6px 10px;">
      ğŸ“‹ Scadenziario
    </a>
    <a href="{{ calendario_url }}" class="btn btn-sm btn-secondary" style="flex: 1; text-align: center; font-size: 12px; padding: 6px 10px;">
      ğŸ“… Calendario
    </a>
    <a href="{{ create_url }}" class="btn btn-sm btn-primary" style="width: 100%; text-align: center; font-size: 12px; padding: 6px 10px;">
      + Nuova scadenza
    </a>
  </div>
</section>
